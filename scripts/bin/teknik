#!/usr/bin/ruby -wU

require 'json'

# TODO: Use net/http instead of rest-client

begin
  require 'rest-client'
rescue LoadError
  abort '$ gem install rest-client'
end

TEKNIK = 'https://api.teknik.io/v1/Upload'

ARGV.each do |file|
  request = RestClient.post TEKNIK, file: File.new(file)

  response = JSON.parse request
  url = response['result']['url']

  puts url
  IO.popen('xsel -ib', 'r+') { |c| c.print url }
  IO.popen('xsel -ip', 'r+') { |c| c.print url }
end
