#!/usr/bin/python -S

import sys
import re
from multiprocessing import Pool

PATTERN = re.compile(r'^\s*($|#|[{}])')

def count_lines(file):
    count = 0

    try:
        with open(file, 'r') as file:
            for line in file:
                if PATTERN.match(line):
                    continue
                else:
                    count += 1
    except IsADirectoryError:
        return 0

    return count

def main(argv=sys.argv[1:]):
    args = set(argv)

    if len(args) > 5000:
        try:
            pool = Pool()
            counts = pool.map(count_lines, args)
        finally:
            pool.close()
            pool.join()
    else:
        counts = map(count_lines, args)

    return sum(counts)

if __name__ == '__main__':
    try:
        sloc = main()
        print("SLOC: {}".format(sloc))
    except KeyboardInterrupt:
        pass
