#!/usr/bin/env ruby

trap('INT') { exit }

require 'json'
require 'httparty'
require 'slop'

opts = Slop.parse do |o|
  o.bool '-l', '--loop', default: false
  o.integer '-w', '--wait', default: 5
end

def data
  rmxs_venta  = HTTParty.get 'http://remexas.com'
  rmxs_compra = HTTParty.get 'https://remexas.com/informacion/recargas-paypal/'

  JSON.dump(compra: rmxs_compra[/BsF.\d+/],
            venta: rmxs_venta[/Bs \d+/])
end

if opts.loop?
  puts "Printing every #{opts[:wait]} minutes..."

  loop do
    File.write('/tmp/remexas.json', data)
    sleep(opts[:wait] * 60)
  end
else
  puts data
end
